<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>US Chess Tournament Radar</title>
    <meta
      name="description"
      content="Daily-updating United States chess tournament directory with source aggregation, state filters, and 100-mile city search."
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="hero">
      <div class="container">
        <p class="hero__eyebrow">UNITED STATES CHESS TOURNAMENT RADAR</p>
        <h1>Find tournaments across the United States</h1>
        <p class="hero__subtitle">
          Aggregated from federation calendars, organizer pages, and event platforms. Data refreshes
          every 24 hours.
        </p>
        <div class="hero__meta">
          <span id="sync-label">Last sync: never</span>
          <button id="refresh-button" type="button" class="btn btn--secondary">Refresh now</button>
        </div>
      </div>
    </header>

    <main class="container layout">
      <aside class="panel" aria-label="Filters">
        <h2>Filters</h2>

        <label class="field" for="state-filter">
          <span>US state</span>
          <select id="state-filter">
            <option value="all">All states</option>
          </select>
        </label>

        <label class="field" for="city-input">
          <span>Within 100 miles of city</span>
          <input id="city-input" type="text" placeholder="Dallas, TX" autocomplete="off" />
        </label>

        <div class="row">
          <button id="apply-city" type="button" class="btn">Apply</button>
          <button id="clear-city" type="button" class="btn btn--secondary">Clear</button>
        </div>

        <p id="status-message" class="muted" aria-live="polite"></p>

      <section class="panel" aria-label="Tournament results">
        <div class="results-head">
          <h2>Tournaments</h2>
          <p id="result-count" class="muted">Waiting for dataâ€¦</p>
        </div>

        <div id="cards" class="cards"></div>
      </section>
    </main>

    <template id="card-template">
      <article class="card">
        <h3 class="card__title"></h3>
        <p class="card__dates"></p>
        <p class="card__location"></p>
        <p class="card__format"></p>
        <div class="chips"></div>
        <button type="button" class="btn card__open">Open details</button>
      </article>
    </template>

    <script>
      window.__radarBooted = false;
      window.setTimeout(() => {
        if (window.__radarBooted) return;

        const status = document.getElementById("status-message");
        const resultCount = document.getElementById("result-count");
        const cards = document.getElementById("cards");

        if (status) {
          status.textContent = "The app script did not load. Re-copy app.js, data.js, and utils.js as full files.";
        }
        if (resultCount) {
          resultCount.textContent = "Data did not load";
        }
        if (cards && !cards.children.length) {
          cards.innerHTML = '<p class="muted">No cards rendered yet. This usually means one JS file was pasted with extra markdown text.</p>';
        }
      }, 2500);

      window.addEventListener("error", (event) => {
        if (window.__radarBooted) return;

        const status = document.getElementById("status-message");
        const resultCount = document.getElementById("result-count");
        const cards = document.getElementById("cards");
        const locationHint = event.filename ? `${event.filename}:${event.lineno || "?"}` : "unknown file";

        if (status) {
          status.textContent = `JavaScript error before startup (${locationHint}). Re-copy app.js, data.js, and utils.js as plain file text only.`;
        }
        if (resultCount) {
          resultCount.textContent = "Startup error";
        }
        if (cards && !cards.children.length) {
          cards.innerHTML = `<p class="muted">Startup failed: ${event.message || "Unknown JavaScript error"}</p>`;
        }
      });

      const moduleScript = document.getElementById("app-module");
      if (moduleScript) {
        moduleScript.addEventListener("error", () => {
          if (window.__radarBooted) return;
          const status = document.getElementById("status-message");
          if (status) {
            status.textContent = "Could not load app.js. Confirm app.js exists in repo root and has no extra markdown/citation text.";
          }
        });
      }
    </script>
    <script type="module" src="app.js" id="app-module"></script>
  </body>
</html>
